var t=this&&this.__extends||function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),a=this&&this.__awaiter||function(t,e,a,r){return new(a||(a=Promise))((function(n,l){function o(t){try{s(r.next(t))}catch(t){l(t)}}function i(t){try{s(r.throw(t))}catch(t){l(t)}}function s(t){var e;t.done?n(t.value):new a((function(e){e(t.value)})).then(o,i)}s((r=r.apply(t,e||[])).next())}))},l=this&&this.__generator||function(t,e){var a,r,l,n,o={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),n;function i(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(l=2&t[0]?r.return:t[0]?r.throw||((l=r.return)&&l.call(n),0):r.next)&&!(l=l.call(r,t[1])).done)return l;switch(r=0,l&&(t=[2&t[0],l.value]),t[0]){case 0:case 1:l=t;break;case 4:return o.label++,{value:t[1],done:!1};case 5:o.label++,r=t[1],t=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(l=o.trys,l=l.length>0&&l[l.length-1])&&(6===t[0]||2===t[0])){o=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){o.label=t[1];break}if(6===t[0]&&o.label<l[1]){o.label=l[1],l=t;break}if(l&&o.label<l[2]){o.label=l[2],o.ops.push(t);break}l[2]&&o.ops.pop(),o.trys.pop();continue}t=e.call(t,o)}catch(t){t=[6,t],r=0}finally{a=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),n=require("@libs/fetch"),o=require("@libs/novelStatus"),i=require("@libs/filterInputs"),u=require("@libs/defaultCover"),s=function(){function e(){this.id="novelfire",this.name="Novel Fire",this.icon="icons/english/novelfire.png",this.site="https://novelfire.net/",this.version="1.0.4"}return e.prototype.getCheerio=function(e,t){return a(this,void 0,void 0,(function(){var a,l,o;return l(this,(function(l){switch(l.label){case 0:return[4,(0,n.fetchApi)(e)];case 1:return[4,(a=l.sent()).text()];case 2:if((o=l.sent()).includes("Cloudflare"))throw new Error("Cloudflare is blocking requests. Try again later.");return[2,r.load(o)]}}))}))},e.prototype.popularNovels=function(e,t){return a(this,arguments,void 0,(function(e,t){var a,r,n,o,i,u,s,c,v,b=this,h=t.showLatestNovels,f=t.filters;return l(this,(function(t){switch(t.label){case 0:if(a=this.site+"search-adv",h)a+="?ctgcon=and&totalchapter=0&ratcon=min&rating=0&status=-1&sort=date&tagcon=and&page=".concat(e);else if(f){for(r=new URLSearchParams,n=0,o=f.language.value;n<o.length;n++)i=o[n],r.append("country_id[]",i);for(r.append("ctgcon",f.genre_operator.value),u=0,s=f.genres.value;u<s.length;u++)c=s[u],r.append("categories[]",c);r.append("totalchapter",f.chapters.value),r.append("ratcon",f.rating_operator.value),r.append("rating",f.rating.value),r.append("status",f.status.value),r.append("sort",f.sort.value),r.append("page",e.toString()),a+="?".concat(r.toString())}else a+="?ctgcon=and&totalchapter=0&ratcon=min&rating=0&status=-1&sort=rank-top&page=".concat(e);return[4,this.getCheerio(a,!1)];case 1:return[2,(v=t.sent())(".novel-item").map((function(e,t){var a=v(t).find(".novel-title > a").text()||"No Title Found",l=b.site+p(v(t).find(".novel-cover > img").attr("data-src")||""),r=v(t).find(".novel-title > a").attr("href");if(r)return{name:a,cover:l,path:p(r.replace(b.site,""))}})).get().filter((function(e){return null!==e}))]}}))}))},e.prototype.getAllChapters=function(e,t){return a(this,void 0,void 0,(function(){var a,o,i,u;return l(this,(function(l){switch(l.label){case 0:return a="".concat(this.site,"listChapterDataAjax?post_id=").concat(t),[4,(0,n.fetchApi)(a)];case 1:return[4,l.sent().text()];case 2:return o=l.sent(),i=JSON.parse(o),u=i.data.map((function(t){var a=r.load(t.title||t.slug).text(),l="".concat(e,"/chapter-").concat(t.n_sort),n=t.n_sort;return l?{name:a,path:l,chapterNumber:Number(n)}:null})).filter((function(e){return null!==e})),[2,u.sort((function(e,t){return e.chapterNumber-t.chapterNumber}))]}}))}))},e.prototype.parseNovel=function(e){return a(this,void 0,void 0,(function(){var t,a,r,n,i,s,c,v,b,h,f,d,g,y;return l(this,(function(l){switch(l.label){case 0:return t=p(e),[4,this.getCheerio(this.site+t,!1)];case 1:return a=l.sent(),r=this.site,"0",(i={path:t}).name=null!==(d=null!==(f=a(".novel-title").text().trim())&&void 0!==f?f:a(".cover > img").attr("alt"))&&void 0!==d?d:"No Titled Found",s=null!==(g=a(".cover > img").attr("data-src"))&&void 0!==g?g:a(".cover > img").attr("src"),i.cover=s?new URL(s,r).href:u.defaultCover,i.genres=a(".categories .property-item").map((function(e,t){return a(t).text()})).toArray().join(","),(c=a(".summary .content").text().trim())?(c=c.replace("Show More",""),i.summary=c):i.summary="No Summary Found",i.author=a(".author .property-item > span").text(),v=a(".header-stats .ongoing").text()||a(".header-stats .completed").text()||"Unknown",b={ongoing:o.NovelStatus.Ongoing,hiatus:o.NovelStatus.OnHiatus,dropped:o.NovelStatus.Cancelled,cancelled:o.NovelStatus.Cancelled,completed:o.NovelStatus.Completed,unknown:o.NovelStatus.Unknown},i.status=null!==(y=b[v.toLowerCase()])&&void 0!==y?y:o.NovelStatus.Unknown,i.rating=parseFloat(a(".nub").text().trim()),n=a("#novel-report").attr("report-post_id")||"0",h=i,[4,this.getAllChapters(t,n)];case 2:return h.chapters=l.sent(),[2,i]}}))}))},e.prototype.parseChapter=function(e){return a(this,void 0,void 0,(function(){var t,a,r,n,o,i,u,s;return l(this,(function(l){switch(l.label){case 0:return t=this.site+e,[4,this.getCheerio(t,!1)];case 1:for(a=l.sent(),r=a("#content"),n=r.find(":not(p, h1, span, i, b, u, img, a, div)"),o=0,i=n.toArray();o<i.length;o++)u=i[o],u.name.toString().length>5&&a(u).remove();return[2,(null===(s=r.html())||void 0===s?void 0:s.replace(/&nbsp;/g," "))||""]}}))}))},e.prototype.searchNovels=function(e,t){return a(this,void 0,void 0,(function(){var a,o,i,u=this;return l(this,(function(l){switch(l.label){case 0:return a="".concat(this.site,"search?keyword=").concat(encodeURIComponent(e),"&page=").concat(t),[4,(0,n.fetchApi)(a)];case 1:return[4,l.sent().text()];case 2:return o=l.sent(),[2,(i=r.load(o))(".novel-list.chapters .novel-item").map((function(e,t){var a=i(t).find("a").attr("title")||"No Title Found",l=u.site+p(i(t).find(".novel-cover > img").attr("src")||""),r=i(t).find("a").attr("href");return r?{name:a,cover:l,path:p(r.replace(u.site,""))}:null})).get().filter((function(e){return null!==e}))]}}))}))},e}();exports.default=new s;function p(e){return"/"==e.charAt(0)?e.substring(1):e}
